@(currentPage: io.ebean.PagedList[Crop],
    currentSortBy: String,
    currentOrder: String,
    currentFilter: String)(
    implicit request: Http.Request,
    messages: play.i18n.Messages)
@import utils.GlobalConfigHelper

@****************************************
* Helper generating navigation links    *
****************************************@
@link(newPage:Int, newSortBy:String) = @{

  var sortBy = currentSortBy
  var order = currentOrder

  if(newSortBy != null) {
    sortBy = newSortBy
    if(currentSortBy == newSortBy) {
      if(currentOrder == "asc") {
        order = "desc"
      } else {
        order = "asc"
      }
    } else {
      order = "asc"
    }
  }

  // Generate the link
  routes.CropController.list(newPage, sortBy, order, currentFilter)

}

  @**********************************
  * Helper generating table headers *
  ***********************************@
@header(key:String, title:String) = {
  <th scope="col" class="@key.replace(".","_")">
    <a class="sort-link @if(currentSortBy != key) { sort-link-inactive }" href="@link(0, key)">@title @sortIcon(key)</a>
  </th>
}


@sortIcon(key:String) = {
@if(currentOrder == "asc") {
  <i class="fa fa-fw fa-caret-down"></i>
} else {
  <i class="fa fa-fw fa-caret-up"></i>
}

}

@main {

  <div class="content-header">
    <div class="container-fluid">
      <div class="row mb-2">
        <div class="col-sm-6">
          <h1 id="page-title">@Messages("crops.list.title", currentPage.getTotalCount)</h1>
        </div>
        <div class="col-sm-6">
          <ol class="breadcrumb float-sm-right">
            <li class="breadcrumb-item"><a href="@routes.HomeController.index()">@messages("nav.dashboard")</a></li>
            <li class="breadcrumb-item active">@messages("nav.crops")</li>
          </ol>
        </div>
      </div>
    </div>
  </div>

  <section class="content">
    <div class="container-fluid">

      @request.flash.asScala().get("success").map { successFlashValue =>
        <div class="alert alert-success alert-dismissible fade show" role="alert">
          <i class="fas fa-check mr-2"></i><strong>@messages("form.success")</strong> @successFlashValue
          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
      }

      <div class="card">
        <div class="card-header">
          <h3 class="card-title">@messages("crops.list.subtitle")</h3>
          <div class="card-tools">
            <a href="@routes.CropController.create()" class="btn btn-primary btn-sm">
              <i class="fas fa-plus mr-1"></i>@messages("crops.add.button")
            </a>
          </div>
        </div>

        <div class="card-body">
          <!-- Search Form -->
          <div class="row mb-3">
            <div class="col-md-6">
              <form action="@link(0, "name")" method="GET">
                <div class="input-group">
                  <input type="search" class="form-control" name="f" value="@currentFilter" 
                         placeholder="@messages("crops.filter.placeholder")">
                  <div class="input-group-append">
                    <button type="submit" class="btn btn-outline-primary">
                      <i class="fas fa-search"></i>
                    </button>
                  </div>
                </div>
              </form>
            </div>
          </div>

          @if(currentPage.getTotalCount == 0) {
            <div class="callout callout-info">
              <h5>@messages("list.empty.title")</h5>
              <p>@messages("crops.empty.message")</p>
            </div>
          } else {
            <div class="table-responsive">
              <table class="table table-bordered table-striped">
                <thead>
                  <tr>
                    @header("name", messages("crop.name"))
                    @header("introduced", messages("crop.introduced"))
                    @header("discontinued", messages("crop.discontinued"))
                    @header("company.name", messages("crop.company"))
                    <th>@messages("form.actions")</th>
                  </tr>
                </thead>
                <tbody>

                @for(crop <- currentPage.getList.asScala) {
                  <tr>
                    <td><strong>@crop.getName()</strong></td>
                    <td>
                      @if(crop.getIntroduced() == null) {
                        <span class="text-muted">@messages("form.not.set")</span>
                      } else {
                        @crop.getIntroduced().format("dd MMM yyyy")
                      }
                    </td>
                    <td>
                      @if(crop.getDiscontinued() == null) {
                        <span class="text-muted">@messages("form.not.set")</span>
                      } else {
                        @crop.getDiscontinued().format("dd MMM yyyy")
                      }
                    </td>
                    <td>
                      @if(crop.getCompany() == null) {
                        <span class="text-muted">@messages("form.not.set")</span>
                      } else {
                        @crop.getCompany().getName()
                      }
                    </td>
                    <td>
                      <a href="@routes.CropController.edit(crop.getId())" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-edit"></i> @messages("form.edit")
                      </a>
                    </td>
                  </tr>
                }

                </tbody>
              </table>
            </div>

            <!-- Pagination -->
            <div class="row">
              <div class="col-sm-5">
                <div class="dataTables_info">
                  @messages("pagination.showing") @currentPage.getDisplayXtoYofZ(" to ", " of ") @messages("pagination.entries")
                </div>
              </div>
              <div class="col-sm-7">
                <nav aria-label="...">
                  <ul class="pagination pagination-sm float-right">
                    @if(currentPage.hasPrev) {
                      <li class="page-item">
                        <a class="page-link" href="@link(currentPage.getPageIndex - 1, null)">
                          <i class="fas fa-angle-left"></i>
                        </a>
                      </li>
                    } else {
                      <li class="page-item disabled">
                        <span class="page-link"><i class="fas fa-angle-left"></i></span>
                      </li>
                    }
                    
                    @if(currentPage.hasNext) {
                      <li class="page-item">
                        <a class="page-link" href="@link(currentPage.getPageIndex + 1, null)">
                          <i class="fas fa-angle-right"></i>
                        </a>
                      </li>
                    } else {
                      <li class="page-item disabled">
                        <span class="page-link"><i class="fas fa-angle-right"></i></span>
                      </li>
                    }
                  </ul>
                </nav>
              </div>
            </div>
          }

        </div>
      </div>
    </div>
  </section>

}
