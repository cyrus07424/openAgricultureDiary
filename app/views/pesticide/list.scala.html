@(currentPage: io.ebean.PagedList[PesticideRegistration],
    currentSortBy: String,
    currentOrder: String,
    currentFilter: String)(
    implicit request: Http.Request,
    messages: play.i18n.Messages)
@import utils.GlobalConfigHelper

@****************************************
* Helper generating navigation links    *
****************************************@
@link(newPage:Int, newSortBy:String) = @{

  var sortBy = currentSortBy
  var order = currentOrder

  if(newSortBy != null) {
    sortBy = newSortBy
    if(currentSortBy == newSortBy) {
      if(currentOrder == "asc") {
        order = "desc"
      } else {
        order = "asc"
      }
    } else {
      order = "asc"
    }
  }

  // Generate the link
  routes.PesticideController.list(newPage, sortBy, order, currentFilter)

}

@**********************************
* Helper generating table headers *
***********************************@
@header(key:String, title:String) = {
  <th scope="col" class="@key.replace(".","_")">
    <a class="sort-link @if(currentSortBy != key) { sort-link-inactive }" href="@link(0, key)">@title @sortIcon(key)</a>
  </th>
}

@sortIcon(key:String) = {
@if(currentOrder == "asc") {
  <i class="fa fa-fw fa-caret-down"></i>
} else {
  <i class="fa fa-fw fa-caret-up"></i>
}
}

@main {

  <h1 class="my-3" id="page-title">農薬登録情報管理 (@currentPage.getTotalCount 件)</h1>

  @request.flash.asScala().get("success").map { successFlashValue =>
    <div class="alert alert-success" role="alert">
      <strong>完了!</strong> @successFlashValue
    </div>
  }

  <div class="row">
    <div class="col-sm-4">
      <form class="form-inline" action="@link(0, "registrationNumber")" method="GET">
        <div class="form-group mr-sm-2 mb-2">
          <label for="searchbox" class="sr-only">検索...</label>
          <input type="search" class="form-control" id="searchbox" name="f" value="@currentFilter" placeholder="登録番号、農薬名、作物名で検索...">
        </div>
        <button type="submit" id="searchsubmit" class="btn btn-primary mb-2">検索</button>
      </form>
    </div>
    <div class="col-sm-8">
      <div class="float-right">
        <a href="@routes.PesticideController.showUpload()" id="upload" class="btn btn-success mr-2" role="button">ZIPファイルアップロード</a>
        @if(currentPage.getTotalCount > 0) {
          <form method="POST" action="@routes.PesticideController.clear()" style="display: inline;" 
                onsubmit="return confirm('全ての農薬登録情報を削除してもよろしいですか？');">
            <button type="submit" class="btn btn-danger">全削除</button>
          </form>
        }
      </div>
    </div>
  </div>

  @if(currentPage.getTotalCount == 0) {

    <div class="card card-body bg-light">
      <em>農薬登録情報がありません。ZIPファイルをアップロードしてデータを追加してください。</em>
    </div>

  } else {

    <div class="table-responsive">
      <table class="table table-bordered table-striped table-hover table-sm">
        <thead class="thead-light">
          <tr>
            @header("registrationNumber", "登録番号")
            @header("usage", "用途")
            @header("pesticideType", "農薬の種類")
            @header("pesticideName", "農薬の名称")
            @header("cropName", "作物名")
            @header("sprayVolume", "散布液量")
            @header("usageTime", "使用時期")
            @header("mainAgentUsageCount", "本剤の使用回数")
            @header("usageMethod", "使用方法")
            <th scope="col">詳細</th>
          </tr>
        </thead>
        <tbody>

        @for(pesticide <- currentPage.getList.asScala) {
          <tr>
            <td>@pesticide.getRegistrationNumber()</td>
            <td>@pesticide.getUsage()</td>
            <td>@pesticide.getPesticideType()</td>
            <td>@pesticide.getPesticideName()</td>
            <td>@pesticide.getCropName()</td>
            <td>@pesticide.getSprayVolume()</td>
            <td>@pesticide.getUsageTime()</td>
            <td>@pesticide.getMainAgentUsageCount()</td>
            <td>@pesticide.getUsageMethod()</td>
            <td>
              <button type="button" class="btn btn-sm btn-info" data-toggle="modal" data-target="#detailModal@pesticide.getId()">
                詳細
              </button>
            </td>
          </tr>
          
          <!-- Detail Modal -->
          <div class="modal fade" id="detailModal@pesticide.getId()" tabindex="-1" role="dialog" aria-labelledby="detailModalLabel@pesticide.getId()" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="detailModalLabel@pesticide.getId()">農薬登録詳細: @pesticide.getPesticideName()</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  <div class="row">
                    <div class="col-md-6">
                      <h6>基本情報</h6>
                      <p><strong>登録番号:</strong> @pesticide.getRegistrationNumber()</p>
                      <p><strong>用途:</strong> @pesticide.getUsage()</p>
                      <p><strong>農薬の種類:</strong> @pesticide.getPesticideType()</p>
                      <p><strong>農薬の名称:</strong> @pesticide.getPesticideName()</p>
                      <p><strong>略称:</strong> @pesticide.getAbbreviation()</p>
                      <p><strong>作物名:</strong> @pesticide.getCropName()</p>
                      <p><strong>適用場所:</strong> @pesticide.getApplicationLocation()</p>
                      <p><strong>適用病害虫雑草名:</strong> @pesticide.getTargetPestDisease()</p>
                      <p><strong>使用目的:</strong> @pesticide.getPurpose()</p>
                      <p><strong>希釈倍数使用量:</strong> @pesticide.getDilutionAmount()</p>
                    </div>
                    <div class="col-md-6">
                      <h6>使用条件</h6>
                      <p><strong>散布液量:</strong> @pesticide.getSprayVolume()</p>
                      <p><strong>使用時期:</strong> @pesticide.getUsageTime()</p>
                      <p><strong>本剤の使用回数:</strong> @pesticide.getMainAgentUsageCount()</p>
                      <p><strong>使用方法:</strong> @pesticide.getUsageMethod()</p>
                      <p><strong>くん蒸時間:</strong> @pesticide.getFumigationTime()</p>
                      <p><strong>くん蒸温度:</strong> @pesticide.getFumigationTemperature()</p>
                      <p><strong>適用土壌:</strong> @pesticide.getApplicableSoil()</p>
                      <p><strong>適用地帯名:</strong> @pesticide.getApplicableZoneName()</p>
                      <p><strong>適用農薬名:</strong> @pesticide.getApplicablePesticideName()</p>
                      <p><strong>混合数:</strong> @pesticide.getMixtureCount()</p>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-12">
                      <h6>有効成分の総使用回数</h6>
                      <p><strong>有効成分①:</strong> @pesticide.getActiveIngredient1TotalUsage()</p>
                      <p><strong>有効成分②:</strong> @pesticide.getActiveIngredient2TotalUsage()</p>
                      <p><strong>有効成分③:</strong> @pesticide.getActiveIngredient3TotalUsage()</p>
                      <p><strong>有効成分④:</strong> @pesticide.getActiveIngredient4TotalUsage()</p>
                      <p><strong>有効成分⑤:</strong> @pesticide.getActiveIngredient5TotalUsage()</p>
                    </div>
                  </div>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">閉じる</button>
                </div>
              </div>
            </div>
          </div>
        }

        </tbody>
      </table>
    </div>

    <nav aria-label="...">
      <ul class="pagination float-right">
        @if(currentPage.hasPrev) {
          <li class="page-item previous">
            <a class="page-link" href="@link(currentPage.getPageIndex - 1, null)">&larr; 前へ</a>
          </li>
        } else {
          <li class="page-item previous disabled">
            <a class="page-link">&larr; 前へ</a>
          </li>
        }
        <li class="page-item disabled" aria-current="page">
          <a class="page-link" href="#">@currentPage.getDisplayXtoYofZ(" - "," / ")</a>
        </li>
        @if(currentPage.hasNext) {
          <li class="page-item next">
            <a class="page-link" href="@link(currentPage.getPageIndex + 1, null)">次へ &rarr;</a>
          </li>
        } else {
          <li class="page-item next disabled">
            <a class="page-link" >次へ &rarr;</a>
          </li>
        }
      </ul>
    </nav>

  }
}